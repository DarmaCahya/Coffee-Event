const wheel = [
  {
    name: "Aromas",
    children: [
      {
        name: "Enzymatic",
        children: [
          {
            name: "Flowery",
            children: [
              {
                name: "Floral",
                children: [
                  {
                    name: "Coffee Blossom",
                    colour: "#f9f0ab",
                  },
                  {
                    name: "Tea Rose",
                    colour: "#e8e596",
                  },
                ],
              },
              {
                name: "Fragrant",
                children: [
                  {
                    name: "Cardamon Caraway",
                    colour: "#f0e2a3",
                  },
                  {
                    name: "Coriander Seeds",
                    colour: "#ede487",
                  },
                ],
              },
            ],
          },
          {
            name: "Fruity",
            children: [
              {
                name: "Citrus",
                children: [
                  {
                    name: "Lemon",
                    colour: "#efd580",
                  },
                  {
                    name: "Apple",
                    colour: "#f1cb82",
                  },
                ],
              },
              {
                name: "Berry-like",
                children: [
                  {
                    name: "Apricot",
                    colour: "#f1c298",
                  },
                  {
                    name: "Blackberry",
                    colour: "#e8b598",
                  },
                ],
              },
            ],
          },
          {
            name: "Herby",
            children: [
              {
                name: "Alliaceous",
                children: [
                  {
                    name: "Onion",
                    colour: "#d5dda1",
                  },
                  {
                    name: "Garlic",
                    colour: "#c9d2b5",
                  },
                ],
              },
              {
                name: "Leguminous",
                children: [
                  {
                    name: "Cucumber",
                    colour: "#aec1ad",
                  },
                  {
                    name: "Garden Peas",
                    colour: "#a7b8a8",
                  },
                ],
              },
            ],
          },
        ],
      },
      {
        name: "Sugar Browning",
        children: [
          {
            name: "Nutty",
            children: [
              {
                name: "Nut-like",
                children: [
                  {
                    name: "Roasted Peanuts",
                    colour: "#b49a3d",
                  },
                  {
                    name: "Walnuts",
                    colour: "#b28647",
                  },
                ],
              },
              {
                name: "Malt-like",
                children: [
                  {
                    name: "Balsamic Rice",
                    colour: "#a97d32",
                  },
                  {
                    name: "Toast",
                    colour: "#b68334",
                  },
                ],
              },
            ],
          },
          {
            name: "Carmelly",
            children: [
              {
                name: "Candy-like",
                children: [
                  {
                    name: "Roasted Hazelnut",
                    colour: "#d6a680",
                  },
                  {
                    name: "Roasted Almond",
                    colour: "#dfad70",
                  },
                ],
              },
              {
                name: "Syrup-like",
                children: [
                  {
                    name: "Honey",
                    colour: "#a2765d",
                  },
                  {
                    name: "Maple Syrup",
                    colour: "#9f6652",
                  },
                ],
              },
            ],
          },
          {
            name: "Chocolatey",
            children: [
              {
                name: "Chocolate-like",
                children: [
                  {
                    name: "Bakers",
                    colour: "#b9763f",
                  },
                  {
                    name: "Dark Chocolate",
                    colour: "#bf6e5d",
                  },
                ],
              },
              {
                name: "Vanilla-like",
                children: [
                  {
                    name: "Swiss",
                    colour: "#af643c",
                  },
                  {
                    name: "Butter",
                    colour: "#9b4c3f",
                  },
                ],
              },
            ],
          },
        ],
      },
      {
        name: "Dry Distillation",
        children: [
          {
            name: "Resinous",
            children: [
              {
                name: "Turpeny",
                children: [
                  {
                    name: "Piney",
                    colour: "#72659d",
                  },
                  {
                    name: "Blackcurrant-like",
                    colour: "#8a6e9e",
                  },
                ],
              },
              {
                name: "Medicinal",
                children: [
                  {
                    name: "Camphoric",
                    colour: "#8f5c85",
                  },
                  {
                    name: "Cineolic",
                    colour: "#934b8b",
                  },
                ],
              },
            ],
          },
          {
            name: "Spicy",
            children: [
              {
                name: "Warming",
                children: [
                  {
                    name: "Cedar",
                    colour: "#9d4e87",
                  },
                  {
                    name: "Pepper",
                    colour: "#92538c",
                  },
                ],
              },
              {
                name: "Pungent",
                children: [
                  {
                    name: "Clove",
                    colour: "#8b6397",
                  },
                  {
                    name: "Thyme",
                    colour: "#716084",
                  },
                ],
              },
            ],
          },
          {
            name: "Carbony",
            children: [
              {
                name: "Smokey",
                children: [
                  {
                    name: "Tarry",
                    colour: "#2e6093",
                  },
                  {
                    name: "Pipe Tobacco",
                    colour: "#3a5988",
                  },
                ],
              },
              {
                name: "Ashy",
                children: [
                  {
                    name: "Burnt",
                    colour: "#4a5072",
                  },
                  {
                    name: "Charred",
                    colour: "#393e64",
                  },
                ],
              },
            ],
          },
        ],
      },
    ],
  },
  {
    name: "Tastes",
    children: [
      {
        name: "Bitter",
        children: [
          {
            name: "Pungent",
            children: [
              {
                name: "Creosol",
                colour: "#aaa1cc",
              },
              {
                name: "Phenolic",
                colour: "#e0b5c9",
              },
            ],
          },
          {
            name: "Harsh",
            children: [
              {
                name: "Caustic",
                colour: "#e098b0",
              },
              {
                name: "Alkaline",
                colour: "#ee82a2",
              },
            ],
          },
        ],
      },
      {
        name: "Salt",
        children: [
          {
            name: "Sharp",
            children: [
              {
                name: "Astringent",
                colour: "#ef91ac",
              },
              {
                name: "Rough",
                colour: "#eda994",
              },
            ],
          },
          {
            name: "Bland",
            children: [
              {
                name: "Neutral",
                colour: "#eeb798",
              },
              {
                name: "Soft",
                colour: "#ecc099",
              },
            ],
          },
        ],
      },
      {
        name: "Sweet",
        children: [
          {
            name: "Mellow",
            children: [
              {
                name: "Delicate",
                colour: "#f6d5aa",
              },
              {
                name: "Mild",
                colour: "#f0d48a",
              },
            ],
          },
          {
            name: "Acidy",
            children: [
              {
                name: "Nippy",
                colour: "#efd95f",
              },
              {
                name: "Piquant",
                colour: "#eee469",
              },
            ],
          },
        ],
      },
      {
        name: "Sour",
        children: [
          {
            name: "Winey",
            children: [
              {
                name: "Tangy",
                colour: "#dbdc7f",
              },
              {
                name: "Tart",
                colour: "#dfd961",
              },
            ],
          },
          {
            name: "Soury",
            children: [
              {
                name: "Hard",
                colour: "#ebe378",
              },
              {
                name: "Acrid",
                colour: "#f5e351",
              },
            ],
          },
        ],
      },
    ],
  },
];

!(function () {
  function t(n, e) {
    return n === e
      ? !0
      : n.children
      ? n.children.some(function (n) {
          return t(n, e);
        })
      : !1;
  }
  function n(t) {
    if (t.children) {
      var e = t.children.map(n),
        r = d3.hsl(e[0]),
        a = d3.hsl(e[1]);
      return d3.hsl((r.h + a.h) / 2, 1.2 * r.s, r.l / 1.2);
    }
    return t.colour || "#fff";
  }
  function e(t) {
    var n = r(t),
      e = d3.interpolate(d.domain(), [t.x, t.x + t.dx]),
      a = d3.interpolate(u.domain(), [t.y, n]),
      i = d3.interpolate(u.range(), [t.y ? 20 : 0, o]);
    return function (t) {
      return function (n) {
        return d.domain(e(n)), u.domain(a(n)).range(i(n)), x(t);
      };
    };
  }
  function r(t) {
    return t.children ? Math.max.apply(Math, t.children.map(r)) : t.y + t.dy;
  }
  function a(t) {
    return 0.299 * t.r + 0.587 * t.g + 0.114 * t.b;
  }
  var i = 840,
    l = i,
    o = i / 2,
    d = d3.scale.linear().range([0, 2 * Math.PI]),
    u = d3.scale.pow().exponent(1.3).domain([0, 1]).range([0, o]),
    c = 5,
    s = 1e3,
    h = d3.select("#vis");
  h.select("img").remove();
  var f = h
    .append("svg")
    .attr("width", i + 2 * c)
    .attr("height", l + 2 * c)
    .append("g")
    .attr("transform", "translate(" + [o + c, o + c] + ")");
  var p = d3.layout
      .partition()
      .sort(null)
      .value(function (t) {
        return 5.8 - t.depth;
      }),
    x = d3.svg
      .arc()
      .startAngle(function (t) {
        return Math.max(0, Math.min(2 * Math.PI, d(t.x)));
      })
      .endAngle(function (t) {
        return Math.max(0, Math.min(2 * Math.PI, d(t.x + t.dx)));
      })
      .innerRadius(function (t) {
        return Math.max(0, t.y ? u(t.y) : t.y);
      })
      .outerRadius(function (t) {
        return Math.max(0, u(t.y + t.dy));
      });
  d3.json("./wheel.json", function (r, i) {
    function l(n) {
      h.transition().duration(s).attrTween("d", e(n)),
        m
          .style("visibility", function (e) {
            return t(n, e) ? null : d3.select(this).style("visibility");
          })
          .transition()
          .duration(s)
          .attrTween("text-anchor", function (t) {
            return function () {
              return d(t.x + t.dx / 2) > Math.PI ? "end" : "start";
            };
          })
          .attrTween("transform", function (t) {
            var n = (t.name || "").split(" ").length > 1;
            return function () {
              var e = (180 * d(t.x + t.dx / 2)) / Math.PI - 90,
                r = e + (n ? -0.5 : 0);
              return "rotate(" + r + ")translate(" + (u(t.y) + c) + ")rotate(" + (e > 90 ? -180 : 0) + ")";
            };
          })
          .style("fill-opacity", function (e) {
            return t(n, e) ? 1 : 1e-6;
          })
          .each("end", function (e) {
            d3.select(this).style("visibility", t(n, e) ? null : "hidden");
          });
    }
    var o = p.nodes({ children: i }),
      h = f.selectAll("path").data(o);
    h.enter()
      .append("path")
      .attr("id", function (t, n) {
        return "path-" + n;
      })
      .attr("d", x)
      .attr("fill-rule", "evenodd")
      .style("fill", n)
      .on("click", l);
    var m = f.selectAll("text").data(o),
      y = m
        .enter()
        .append("text")
        .style("fill-opacity", 1)
        .style("fill", function (t) {
          return a(d3.rgb(n(t))) < 125 ? "#eee" : "#000";
        })
        .attr("text-anchor", function (t) {
          return d(t.x + t.dx / 2) > Math.PI ? "end" : "start";
        })
        .attr("dy", ".2em")
        .attr("transform", function (t) {
          var n = (t.name || "").split(" ").length > 1,
            e = (180 * d(t.x + t.dx / 2)) / Math.PI - 90,
            r = e + (n ? -0.5 : 0);
          return "rotate(" + r + ")translate(" + (u(t.y) + c) + ")rotate(" + (e > 90 ? -180 : 0) + ")";
        })
        .on("click", l);
    y
      .append("tspan")
      .attr("x", 0)
      .text(function (t) {
        return t.depth ? t.name.split(" ")[0] : "";
      }),
      y
        .append("tspan")
        .attr("x", 0)
        .attr("dy", "1em")
        .text(function (t) {
          return t.depth ? t.name.split(" ")[1] || "" : "";
        });
  });
})();
